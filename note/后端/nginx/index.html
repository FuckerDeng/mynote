<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习Nginx这一篇就够了 | 笔记整理</title>
    <meta name="description" content="来源于网络和自己的笔记，算法，数据结构，Java，JUC，JVM，数学">
    <link rel="preload stylesheet" href="/mynote/assets/style.bf609b55.css" as="style">
    <script type="module" src="/mynote/assets/app.390e3e8c.js"></script>
    <link rel="preload" href="/mynote/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/mynote/assets/chunks/framework.c70c7723.js">
  <link rel="modulepreload" href="/mynote/assets/chunks/theme.66150576.js">
  <link rel="modulepreload" href="/mynote/assets/note_后端_nginx_index.md.77e6c141.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8616af1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8616af1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-94c81dcc><div class="container" data-v-94c81dcc><div class="title" data-v-94c81dcc><div class="VPNavBarTitle has-sidebar" data-v-94c81dcc data-v-f4ef19a3><a class="title" href="/mynote/" data-v-f4ef19a3><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://developer.mozilla.org/favicon-48x48.cbbd161b.png" alt data-v-6db2186b><!--]--><!--[-->我的笔记整理<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-94c81dcc><div class="curtain" data-v-94c81dcc></div><div class="content-body" data-v-94c81dcc><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-94c81dcc><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-94c81dcc data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-94c81dcc data-v-f6a63727><label title="toggle dark mode" data-v-f6a63727 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-94c81dcc data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><label title="toggle dark mode" data-v-40855f84 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-94c81dcc data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-b2cf3e0b data-v-59bd7401><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-59bd7401><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-59bd7401><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-59bd7401>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-59bd7401 data-v-079b16a8><button data-v-079b16a8>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-b2cf3e0b data-v-af16598e><div class="curtain" data-v-af16598e></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-af16598e><span class="visually-hidden" id="sidebar-aria-label" data-v-af16598e> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-af16598e><section class="VPSidebarItem level-0" data-v-af16598e data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>首页</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>linux</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/linux/基础知识/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>基础知识</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/linux/容器技术/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>容器技术</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible has-active" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>后端</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java日志系统/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Java日志系统</p><!--]--><!----></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-c4656e6d data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h3 class="text" data-v-c4656e6d>Java语言基础</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/01.基础语法/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>01.基础语法</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/02.面向对象/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>02.面向对象</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/03.高级语法/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>03.高级语法</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/04.常用模块/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>04.常用模块</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/05.各版本特性/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>05.各版本特性</p><!--]--><!----></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-c4656e6d data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h4 class="text" data-v-c4656e6d>06.并发编程及JUC</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-3 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/06.并发编程及JUC/1.线程共享模型/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>1.线程共享模型</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/06.并发编程及JUC/2.模式/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>2.模式</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/06.并发编程及JUC/3.应用/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>3.应用</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/06.并发编程及JUC/4.原理/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>4.原理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/06.并发编程及JUC/5.volatile的性能分析/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>5.volatile的性能分析</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/07.jvm/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>07.jvm</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/08.字节码动态代码/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>08.字节码动态代码</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/09.常用监控工具/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>09.常用监控工具</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/10.代码热更新/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>10.代码热更新</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/Java语言基础/11.Instrument相关介绍/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>11.Instrument相关介绍</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/后端/nginx/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>nginx</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>数学</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/数理统计/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>数理统计</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/概率论/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>概率论</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/离散数学/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>离散数学</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/线性代数/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>线性代数</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/逻辑学/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>逻辑学</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数学/高等数学/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>高等数学</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>数据库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数据库/mongo/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>mongo</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数据库/mysql/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>mysql</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/数据库/redis/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>redis</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0" data-v-af16598e data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/方法论/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>方法论</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/杂/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>杂</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>编程基础</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/UML/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>UML</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/数据库原理/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>数据库原理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/数据结构与算法/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>数据结构与算法</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/编译原理/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>编译原理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/计算机系统结构/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>计算机系统结构</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/计算机组成/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>计算机组成</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/计算机网络/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>计算机网络</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/编程基础/设计模式/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>设计模式</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0" data-v-af16598e data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/美术/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>美术</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>脚本语言</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/脚本语言/groovy/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>groovy</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/脚本语言/lua/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>lua</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/脚本语言/python/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>python</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>英语</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/英语/词根-词缀记忆/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>词根-词缀记忆</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/mynote/note/英语/语法/" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>语法</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPDoc has-sidebar has-aside" data-v-a494bd1d data-v-c4b0d3cf><!--[--><!--]--><div class="container" data-v-c4b0d3cf><div class="aside" data-v-c4b0d3cf><div class="aside-curtain" data-v-c4b0d3cf></div><div class="aside-container" data-v-c4b0d3cf><div class="aside-content" data-v-c4b0d3cf><div class="VPDocAside" data-v-c4b0d3cf data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-9a431c33><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c4b0d3cf><div class="content-container" data-v-c4b0d3cf><!--[--><!--]--><!----><main class="main" data-v-c4b0d3cf><div style="position:relative;" class="vp-doc _mynote_note_%E5%90%8E%E7%AB%AF_nginx_index" data-v-c4b0d3cf><div><h1 id="学习nginx这一篇就够了" tabindex="-1">学习Nginx这一篇就够了 <a class="header-anchor" href="#学习nginx这一篇就够了" aria-label="Permalink to &quot;学习Nginx这一篇就够了&quot;">​</a></h1><blockquote><p>原文地址：<a href="https://mp.weixin.qq.com/s?__biz=MzU0OTE4MzYzMw==&amp;mid=2247516769&amp;idx=3&amp;sn=2c9b6a79c8bd1476d99057caedb1875d&amp;chksm=fbb10b9fccc682899bc443838d327796d909e217a21ba36d5853a31078e6bf81ccc47fc9bf89&amp;scene=27" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/s?__biz=MzU0OTE4MzYzMw==&amp;mid=2247516769&amp;idx=3&amp;sn=2c9b6a79c8bd1476d99057caedb1875d&amp;chksm=fbb10b9fccc682899bc443838d327796d909e217a21ba36d5853a31078e6bf81ccc47fc9bf89&amp;scene=27</a></p></blockquote><blockquote><p>官网：<a href="https://nginx.org/" target="_blank" rel="noreferrer">https://nginx.org/</a></p></blockquote><blockquote><p>中文文档 ：<a href="https://blog.redis.com.cn/doc/index.html" target="_blank" rel="noreferrer">https://blog.redis.com.cn/doc/index.html</a></p></blockquote><h2 id="第一章-nginx概述" tabindex="-1">第一章：Nginx概述 <a class="header-anchor" href="#第一章-nginx概述" aria-label="Permalink to &quot;第一章：Nginx概述&quot;">​</a></h2><h3 id="_1-1、nginx概述" tabindex="-1">1.1、Nginx概述 <a class="header-anchor" href="#_1-1、nginx概述" aria-label="Permalink to &quot;1.1、Nginx概述&quot;">​</a></h3><p>Nginx（“engine x”）是一个高性能的HTTP和反向代理服务器，特点是占有内存少，并发能力强，事实上Nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用Nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。</p><h3 id="_1-2、nginx用处" tabindex="-1">1.2、Nginx用处 <a class="header-anchor" href="#_1-2、nginx用处" aria-label="Permalink to &quot;1.2、Nginx用处&quot;">​</a></h3><p>Nginx可以作为静态页面的Web服务器，同时还支持CGI协议的动态语言，比如Perl、PHP等。但是不支持Java。Java程序只能通过与Tomcat配合完成。Nginx专为性能优化而开发，性能是其最重要的考量，实现上非常注重效率，能经受高负载的考验，有报告表明能支持高达50000个并发连接数。</p><h2 id="第二章-nginx单实例安装" tabindex="-1">第二章：Nginx单实例安装 <a class="header-anchor" href="#第二章-nginx单实例安装" aria-label="Permalink to &quot;第二章：Nginx单实例安装&quot;">​</a></h2><h3 id="_2-1、环境说明" tabindex="-1">2.1、环境说明 <a class="header-anchor" href="#_2-1、环境说明" aria-label="Permalink to &quot;2.1、环境说明&quot;">​</a></h3><p>模拟工具：VMware-workstation-full-15.5.6-16341506.exe</p><p>操作系统：CentOS-6.10-x86_64-bin-DVD1.iso、纯净安装、桌面版</p><p>内存大小：2GB</p><p>连接工具：SecureCRT</p><h3 id="_2-2、安装依赖" tabindex="-1">2.2、安装依赖 <a class="header-anchor" href="#_2-2、安装依赖" aria-label="Permalink to &quot;2.2、安装依赖&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># yum install -y gcc gcc-c++ make libtool wget pcre pcre-devel zlib zlib-devel openssl openssl-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-3、nginx下载" tabindex="-1">2.3、Nginx下载 <a class="header-anchor" href="#_2-3、nginx下载" aria-label="Permalink to &quot;2.3、Nginx下载&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># wget http://nginx.org/download/nginx-1.18.0.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-4、nginx解压" tabindex="-1">2.4、Nginx解压 <a class="header-anchor" href="#_2-4、nginx解压" aria-label="Permalink to &quot;2.4、Nginx解压&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># tar -zxvf nginx-1.18.0.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-5、nginx安装" tabindex="-1">2.5、Nginx安装 <a class="header-anchor" href="#_2-5、nginx安装" aria-label="Permalink to &quot;2.5、Nginx安装&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># cd nginx-1.18.0</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei nginx-1.18.0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># ./configure</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei nginx-1.18.0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># make </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意：安装完成后的路径为：/usr/local/nginx</p><h3 id="_2-6、nginx命令" tabindex="-1">2.6、Nginx命令 <a class="header-anchor" href="#_2-6、nginx命令" aria-label="Permalink to &quot;2.6、Nginx命令&quot;">​</a></h3><p>普通启动服务：/usr/local/nginx/sbin/nginx</p><p>配置文件启动：/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</p><ul><li><p>暴力停止服务：/usr/local/nginx/sbin/nginx -s stop</p></li><li><p>优雅停止服务：/usr/local/nginx/sbin/nginx -s quit</p></li><li><p>检查配置文件：/usr/local/nginx/sbin/nginx -t</p></li><li><p>重新加载配置：/usr/local/nginx/sbin/nginx -s reload</p></li><li><p>查看相关进程：ps -ef | grep nginx</p></li></ul><h3 id="_2-7、开放防火墙" tabindex="-1">2.7、开放防火墙 <a class="header-anchor" href="#_2-7、开放防火墙" aria-label="Permalink to &quot;2.7、开放防火墙&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /etc/rc.d/init.d/iptables save</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables：将防火墙规则保存到</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/iptables：[确定]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-8、启动后效果" tabindex="-1">2.8、启动后效果 <a class="header-anchor" href="#_2-8、启动后效果" aria-label="Permalink to &quot;2.8、启动后效果&quot;">​</a></h3><p><img src="/mynote/assets/QQ截图20230530152400.fd1dd4d7.png" alt="启动后的效果"></p><h2 id="第三章-nginx反向代理" tabindex="-1">第三章：Nginx反向代理 <a class="header-anchor" href="#第三章-nginx反向代理" aria-label="Permalink to &quot;第三章：Nginx反向代理&quot;">​</a></h2><h3 id="_3-1、概述" tabindex="-1">3.1、概述 <a class="header-anchor" href="#_3-1、概述" aria-label="Permalink to &quot;3.1、概述&quot;">​</a></h3><p>Nginx不仅可以做反向代理，还能用作正向代理来进行上网等功能，正向代理：如果把局域网外的Internet想象成一个巨大的资源库，则局域网中的客户端要访问Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。对于反向代理，客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器IP地址。</p><h3 id="_3-2、配置反向代理实例1" tabindex="-1">3.2、配置反向代理实例1 <a class="header-anchor" href="#_3-2、配置反向代理实例1" aria-label="Permalink to &quot;3.2、配置反向代理实例1&quot;">​</a></h3><h4 id="_3-2-1、实现效果" tabindex="-1">3.2.1、实现效果 <a class="header-anchor" href="#_3-2-1、实现效果" aria-label="Permalink to &quot;3.2.1、实现效果&quot;">​</a></h4><p>打开浏览器，在浏览器地址栏输入地址：<a href="http://www.123.com" target="_blank" rel="noreferrer">http://www.123.com</a>，跳转到Liunx系统Tomcat主页面中。 <img src="/mynote/assets/QQ截图20230530152653.986ba799.png" alt="实现效果"></p><h4 id="_3-2-2、实现思路" tabindex="-1">3.2.2、实现思路 <a class="header-anchor" href="#_3-2-2、实现思路" aria-label="Permalink to &quot;3.2.2、实现思路&quot;">​</a></h4><p><img src="/mynote/assets/QQ截图20230530152749.caffcc50.png" alt="实现思路"></p><h4 id="_3-2-3、实现步骤" tabindex="-1">3.2.3、实现步骤 <a class="header-anchor" href="#_3-2-3、实现步骤" aria-label="Permalink to &quot;3.2.3、实现步骤&quot;">​</a></h4><p>步骤一：修改Windows中的hosts域名映射</p><p>复制“C:\Windows\System32\drivers\etc\hosts”到桌面，右键记事本打开，在里边加上以下代码保存，然后再复制回去，不要直接修改，会不让保存！</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#虚拟机域名       映射的网址</span></span>
<span class="line"><span style="color:#FFCB6B;">192.168.206.128</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">www.123.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>步骤二：修改Nginx中的配置文件并启动</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-conf line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http:127.0.0.1:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">            root   html;</span></span>
<span class="line"><span style="color:#A6ACCD;">            index  index.html index.htm;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>步骤三：下载Tomcat、解压Tomcat、安装Tomcat、启动Tomcat</p><p>注意：Tomcat启动需要JDK，在这里我没有安装，使用系统自带的OpenJDK Runtime Environment (rhel-2.6.14.10.el6-x86_64 u181-b00)</p><p>下载：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># wget https://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.105/bin/apache-tomcat-7.0.105.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>解压：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># tar -zxvf apache-tomcat-7.0.105.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mv apache-tomcat-7.0.105 /usr/local/tomcat</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>启动：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加到防火墙：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /etc/rc.d/init.d/iptables save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果关闭请用：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat/bin/shutdown.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_3-2-4、关闭服务" tabindex="-1">3.2.4、关闭服务 <a class="header-anchor" href="#_3-2-4、关闭服务" aria-label="Permalink to &quot;3.2.4、关闭服务&quot;">​</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat/bin/shutdown.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-3、配置反向代理实例2" tabindex="-1">3.3、配置反向代理实例2 <a class="header-anchor" href="#_3-3、配置反向代理实例2" aria-label="Permalink to &quot;3.3、配置反向代理实例2&quot;">​</a></h3><h4 id="_3-3-1、实现效果" tabindex="-1">3.3.1、实现效果 <a class="header-anchor" href="#_3-3-1、实现效果" aria-label="Permalink to &quot;3.3.1、实现效果&quot;">​</a></h4><p>使用Nginx反向代理，根据访问的路径跳转到不同端口的服务中。 <img src="/mynote/assets/QQ截图20230530153208.17ccc760.png" alt="反向代理实现效果"></p><h4 id="_3-3-2、实现思路" tabindex="-1">3.3.2、实现思路 <a class="header-anchor" href="#_3-3-2、实现思路" aria-label="Permalink to &quot;3.3.2、实现思路&quot;">​</a></h4><p><img src="/mynote/assets/QQ截图20230530153310.71ff6307.png" alt="反向代理实现思路"></p><h4 id="_3-3-3、实现步骤" tabindex="-1">3.3.3、实现步骤 <a class="header-anchor" href="#_3-3-3、实现步骤" aria-label="Permalink to &quot;3.3.3、实现步骤&quot;">​</a></h4><p>步骤一：修改Nginx的配置文件，然后启动</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location ~ /edu/ {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://127.0.0.1:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location ~ /vod/ {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://127.0.0.1:8081;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>步骤二：拷贝两个Tomcat，将其中一个的端口信息修改为8081，开启防火墙，然后分别启动这两台Tomcat</p><p>解压：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># tar -zxvf apache-tomcat-7.0.105.tar.gz</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mv apache-tomcat-7.0.105 /usr/local/tomcat1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># tar -zxvf apache-tomcat-7.0.105.tar.gz</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mv apache-tomcat-7.0.105 /usr/local/tomcat2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>删除：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># rm -f /usr/local/tomcat2/conf/server.xml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/tomcat2/conf/server.xml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#F07178;">xml</span><span style="color:#C792EA;"> version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C792EA;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  Licensed to the Apache Software Foundation (ASF) under one or more</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  contributor license agreements.  See the NOTICE file distributed with</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  this work for additional information regarding copyright ownership.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  The ASF licenses this file to You under the Apache License, Version 2.0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  (the &quot;License&quot;); you may not use this file except in compliance with</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  Unless required by applicable law or agreed to in writing, software</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  See the License for the specific language governing permissions and</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  limitations under the License.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- Note:  A &quot;Server&quot; is not itself a &quot;Container&quot;, so you may not</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     define subcomponents such as &quot;Valves&quot; at this level.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     Documentation at /docs/config/server.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Server</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">port</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8006</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">shutdown</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SHUTDOWN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.startup.VersionLoggerListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- Security listener. Documentation at /docs/config/listeners.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  &lt;Listener className=&quot;org.apache.catalina.security.SecurityListener&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!--APR library loader. Documentation at /docs/apr.html --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.core.AprLifecycleListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">SSLEngine</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!--Initialize Jasper prior to webapps are loaded. Documentation at /docs/jasper-howto.html --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.core.JasperListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- Prevent memory leaks due to use of particular java/javax APIs--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.core.JreMemoryLeakPreventionListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.mbeans.GlobalResourcesLifecycleListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Listener</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.core.ThreadLocalLeakPreventionListener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- Global JNDI resources</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       Documentation at /docs/jndi-resources-howto.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">GlobalNamingResources</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- Editable user database that can also be used by</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         UserDatabaseRealm to authenticate users</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Resource</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UserDatabase</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">auth</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Container</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.UserDatabase</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">User database that can be updated and saved</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#C792EA;">factory</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.users.MemoryUserDatabaseFactory</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#C792EA;">pathname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">conf/tomcat-users.xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">GlobalNamingResources</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- A &quot;Service&quot; is a collection of one or more &quot;Connectors&quot; that share</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       a single &quot;Container&quot; Note:  A &quot;Service&quot; is not itself a &quot;Container&quot;,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       so you may not define subcomponents such as &quot;Valves&quot; at this level.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       Documentation at /docs/config/service.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Service</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Catalina</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--The connectors can use a shared executor, you can define one or more named thread pools--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    &lt;Executor name=&quot;tomcatThreadPool&quot; namePrefix=&quot;catalina-exec-&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        maxThreads=&quot;150&quot; minSpareThreads=&quot;4&quot;/&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- A &quot;Connector&quot; represents an endpoint by which requests are received</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         and responses are returned. Documentation at :</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         Java HTTP Connector: /docs/config/http.html (blocking &amp; non-blocking)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         Java AJP  Connector: /docs/config/ajp.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         APR (HTTP/AJP) Connector: /docs/apr.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         Define a non-SSL HTTP/1.1 Connector on port 8080</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Connector</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">port</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8081</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">protocol</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">               </span><span style="color:#C792EA;">connectionTimeout</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">20000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">               </span><span style="color:#C792EA;">redirectPort</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8444</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- A &quot;Connector&quot; using the shared thread pool--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    &lt;Connector executor=&quot;tomcatThreadPool&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               connectionTimeout=&quot;20000&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               redirectPort=&quot;8444&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- Define an SSL HTTP/1.1 Connector on port 8443</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         This connector uses the BIO implementation that requires the JSSE</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         style configuration. When using the APR/native implementation, the</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         OpenSSL style configuration is required as described in the APR/native</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         documentation --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    &lt;Connector port=&quot;8444&quot; protocol=&quot;org.apache.coyote.http11.Http11Protocol&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    &lt;Connector protocol=&quot;AJP/1.3&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               address=&quot;::1&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               port=&quot;8010&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">               redirectPort=&quot;8444&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- An Engine represents the entry point (within Catalina) that processes</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         every request.  The Engine implementation for Tomcat stand alone</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         analyzes the HTTP headers included with the request, and passes them</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         on to the appropriate Host (virtual host).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         Documentation at /docs/config/engine.html --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- You should set jvmRoute to support load-balancing via AJP ie :</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;jvm1&quot;&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Engine</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Catalina</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">defaultHost</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">&lt;!--For clustering, please take a look at documentation at:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          /docs/cluster-howto.html  (simple how to)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          /docs/config/cluster.html (reference documentation) --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      &lt;Cluster className=&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;/&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">&lt;!-- Use the LockOutRealm to prevent attempts to guess user passwords</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">           via a brute-force attack --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Realm</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.realm.LockOutRealm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">&lt;!-- This Realm uses the UserDatabase configured in the global JNDI</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             resources under the key &quot;UserDatabase&quot;.  Any edits</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             that are performed against this UserDatabase are immediately</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             available for use by the Realm.  --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Realm</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.realm.UserDatabaseRealm</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">               </span><span style="color:#C792EA;">resourceName</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UserDatabase</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">Realm</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Host</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">appBase</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">webapps</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#C792EA;">unpackWARs</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">autoDeploy</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">&lt;!-- SingleSignOn valve, share authentication between web applications</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             Documentation at: /docs/config/valve.html --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        &lt;Valve className=&quot;org.apache.catalina.authenticator.SingleSignOn&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">&lt;!-- Access log processes all example.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             Documentation at: /docs/config/valve.html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">             Note: The pattern used is equivalent to using pattern=&quot;common&quot; --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Valve</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.valves.AccessLogValve</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">directory</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">               </span><span style="color:#C792EA;">prefix</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost_access_log.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">suffix</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">               </span><span style="color:#C792EA;">pattern</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%h %l %u %t </span><span style="color:#89DDFF;">&amp;</span><span style="color:#C3E88D;">quot</span><span style="color:#89DDFF;">;</span><span style="color:#C3E88D;">%r</span><span style="color:#89DDFF;">&amp;</span><span style="color:#C3E88D;">quot</span><span style="color:#89DDFF;">;</span><span style="color:#C3E88D;"> %s %b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">Host</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">Engine</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">Service</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">Server</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br></div></div><p>开启Tomcat2的防火墙：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /sbin/iptables -I INPUT -p tcp --dport 8081 -j ACCEPT</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /etc/rc.d/init.d/iptables save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在每一个Tomcat的WebApps中创建一个文件夹和一个a.html文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mkdir -p /usr/local/tomcat1/webapps/edu</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;This is 8080 Port&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /usr/local/tomcat1/webapps/edu/a.html</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mkdir -p /usr/local/tomcat2/webapps/vod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;This is 8081 Port&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /usr/local/tomcat2/webapps/vod/a.html</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/startup.sh</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>步骤三：打开本机浏览器进行测试</p><p>在浏览器输入：<a href="http://192.168.206.128/edu/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/edu/a.html</a><img src="/mynote/assets/QQ截图20230530153713.ce82742a.png" alt="测试1"></p><p>在浏览器输入：<a href="http://192.168.206.128/vod/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/vod/a.html</a><img src="/mynote/assets/QQ截图20230530153801.06d61a36.png" alt="测试2"></p><h4 id="_3-3-4、关闭服务" tabindex="-1">3.3.4、关闭服务 <a class="header-anchor" href="#_3-3-4、关闭服务" aria-label="Permalink to &quot;3.3.4、关闭服务&quot;">​</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/shutdown.sh</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/shutdown.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-4、location指令说明" tabindex="-1">3.4、location指令说明 <a class="header-anchor" href="#_3-4、location指令说明" aria-label="Permalink to &quot;3.4、location指令说明&quot;">​</a></h3><p>描述：该指令用于匹配URL。</p><p>语法： !(语法)[./.assets/QQ截图20230530153907.png]</p><p>通配符：</p><ul><li><p>=：用于不含正则表达式的uri前，要求请求字符串与uri严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。</p></li><li><p>~：用于表示uri包含正则表达式，并且区分大小写。</p></li><li><p>~*：用于表示uri包含正则表达式，并且不区分大小写。</p></li><li><p>^~：用于不含正则表达式的uri前，要求Nginx服务器找到标识uri和请求字符串匹配度最高的location后，立即使用此location处理请求，而不再使用location块中的正则uri和请求字符串做匹配。</p></li></ul><p>注意：如果uri包含正则表达式，则必须要有~或者~*标识。</p><h2 id="第四章-nginx负载均衡" tabindex="-1">第四章：Nginx负载均衡 <a class="header-anchor" href="#第四章-nginx负载均衡" aria-label="Permalink to &quot;第四章：Nginx负载均衡&quot;">​</a></h2><h3 id="_4-1、概述" tabindex="-1">4.1、概述 <a class="header-anchor" href="#_4-1、概述" aria-label="Permalink to &quot;4.1、概述&quot;">​</a></h3><p>客户端发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行交互，服务器处理完毕后，再将结果返回给客户端。</p><p>这种架构模式对于早期的系统相对单一，并发请求相对较少的情况下是比较适合的，成本也低。但是随着信息数量的不断增长，访问量和数据量的飞速增长，以及系统业务的复杂度增加，这种架构会造成服务器相应客户端的请求日益缓慢，并发量特别大的时候，还容易造成服务器直接崩溃。很明显这是由于服务器性能的瓶颈造成的问题，那么如何解决这种情况呢？</p><p>我们首先想到的可能是升级服务器的配置，比如提高CPU执行频率，加大内存等提高机器的物理性能来解决此问题，但是我们知道摩尔定律的日益失效，硬件的性能提升已经不能满足日益提升的需求了。最明显的一个例子，天猫双十一当天，某个热销商品的瞬时访问量是极其庞大的，那么类似上面的系统架构，将机器都增加到现有的顶级物理配置，都是不能够满足需求的。那么怎么办呢？</p><p>上面的分析我们去掉了增加服务器物理配置来解决问题的办法，也就是说纵向解决问题的办法行不通了，那么横向增加服务器的数量呢？这时候集群的概念产生了，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡。</p><p><img src="/mynote/assets/QQ截图20230530154032.6e03774d.png" alt="负载均衡"></p><h3 id="_4-2、实现效果" tabindex="-1">4.2、实现效果 <a class="header-anchor" href="#_4-2、实现效果" aria-label="Permalink to &quot;4.2、实现效果&quot;">​</a></h3><p>浏览器地址栏输入地址：<a href="http://192.168.206.128/edu/a.html%EF%BC%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%95%88%E6%9E%9C%EF%BC%8C%E5%B0%86%E8%AF%B7%E6%B1%82%E5%B9%B3%E5%9D%87%E5%88%B08080%E5%92%8C8081%E7%AB%AF%E5%8F%A3%E4%B8%AD%E3%80%82" target="_blank" rel="noreferrer">http://192.168.206.128/edu/a.html，负载均衡效果，将请求平均到8080和8081端口中。</a><img src="/mynote/assets/QQ截图20230530154130.9ac94c9c.png" alt="负载均衡效果"></p><h3 id="_4-3、实现思路" tabindex="-1">4.3、实现思路 <a class="header-anchor" href="#_4-3、实现思路" aria-label="Permalink to &quot;4.3、实现思路&quot;">​</a></h3><p><img src="/mynote/assets/QQ截图20230530154208.3c734411.png" alt="负载均衡实现思路"></p><h3 id="_4-4、实现步骤" tabindex="-1">4.4、实现步骤 <a class="header-anchor" href="#_4-4、实现步骤" aria-label="Permalink to &quot;4.4、实现步骤&quot;">​</a></h3><p>第一步：修改Nginx的配置文件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">upstream myserver {</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8081;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://myserver;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第二步：在Tomcat2的webapps文件夹中，创建一个edu文件夹，在里边创建a.html</p><p>创建：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># mkdir -p /usr/local/tomcat2/webapps/edu</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;This is 8081 Port&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /usr/local/tomcat2/webapps/edu/a.html</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/startup.sh</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第三步：测试效果</p><p>打开IE浏览器输入：<a href="http://192.168.206.128/edu/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/edu/a.html</a></p><p><img src="/mynote/assets/image-20230530155010504-1685433018227-1.d00685b9.png" alt="image-20230530155010504"></p><p>打开IE浏览器输入：<a href="http://192.168.206.128/edu/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/edu/a.html</a></p><p><img src="/mynote/assets/image-20230530155159871.3d8f6e5b.png" alt="image-20230530155159871"></p><h3 id="_4-5、关闭服务" tabindex="-1">4.5、关闭服务 <a class="header-anchor" href="#_4-5、关闭服务" aria-label="Permalink to &quot;4.5、关闭服务&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/shutdown.sh</span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/shutdown.sh</span><span style="color:#89DDFF;">*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-6、分配策略" tabindex="-1">4.6、分配策略 <a class="header-anchor" href="#_4-6、分配策略" aria-label="Permalink to &quot;4.6、分配策略&quot;">​</a></h3><p>轮询（默认）：每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p><p><img src="/mynote/assets/image-20230530155324153.c1034b48.png" alt="image-20230530155324153"></p><p>weight：weight代表权重，默认为1，权重越高被分配的客户端越多，weight和访问比率成正比，用于后端服务器性能不均的情况。例如：</p><p><img src="/mynote/assets/image-20230530155338121.d9176363.png" alt="image-20230530155338121"></p><p>ip_hash：每个请求按访问IP的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。例如：</p><p><img src="/mynote/assets/640.556519cc.png" alt="图片"></p><p>fair（第三方）：按后端服务器的响应时间来分配请求，响应时间短的优先分配。例如：</p><p><img src="/mynote/assets/640-1685433236988-3.165a0f54.png" alt="图片"></p><h2 id="第五章-nginx动静分离" tabindex="-1">第五章：Nginx动静分离 <a class="header-anchor" href="#第五章-nginx动静分离" aria-label="Permalink to &quot;第五章：Nginx动静分离&quot;">​</a></h2><h3 id="_5-1、概述" tabindex="-1">5.1、概述 <a class="header-anchor" href="#_5-1、概述" aria-label="Permalink to &quot;5.1、概述&quot;">​</a></h3><p>Nginx动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用Nginx处理静态页面，Tomcat处理动态页面。动静分离从目前实现角度来讲大致分为两种，一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案；另外一种方法就是动态跟静态文件混合在一起发布，通过Nginx来分开。</p><h3 id="_5-2、实现效果" tabindex="-1">5.2、实现效果 <a class="header-anchor" href="#_5-2、实现效果" aria-label="Permalink to &quot;5.2、实现效果&quot;">​</a></h3><p>如果不设置动静分离，默认会通过Nginx的反向代理去找Tomcat对应的资源，现在我们在根目录下创建一个/data/www/文件夹，里边放上静态资源，比如一个html页面，在8080的那台Tomcat的WebApps下也创建一个www目录，同样是放一个静态资源，当输入这个静态资源的请求时，访问到的是/data/www中的数据。</p><p><img src="/mynote/assets/640-1685433286469-8.e52bfa59.png" alt="图片"></p><h3 id="_5-3、实现思路" tabindex="-1">5.3、实现思路 <a class="header-anchor" href="#_5-3、实现思路" aria-label="Permalink to &quot;5.3、实现思路&quot;">​</a></h3><p><img src="/mynote/assets/640-1685433298584-11.b9fec61d.png" alt="图片"></p><h3 id="_5-4、实现步骤" tabindex="-1">5.4、实现步骤 <a class="header-anchor" href="#_5-4、实现步骤" aria-label="Permalink to &quot;5.4、实现步骤&quot;">​</a></h3><p>第一步：创建静态资源文件，为了对比，Tomcat中也放一个</p><p>第一步：创建静态资源文件，为了对比，Tomcat中也放一个</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># mkdir -p /data/www/</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># mkdir -p /usr/local/tomcat/webapps/ROOT/www</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;/data/www/a.html&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /data/www/a.html</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;/usr/local/tomcat/webapps/ROOT/www/a.html&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /usr/local/tomcat/webapps/ROOT/www/a.html</span><span style="color:#89DDFF;">*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第二步：修改Nginx的配置文件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location /www/ {</span></span>
<span class="line"><span style="color:#A6ACCD;">            root /data/;</span></span>
<span class="line"><span style="color:#A6ACCD;">            index index.html index.htm;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第三步：启动Tomcat</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[root@caochenlei ~]# /usr/local/tomcat/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第四步：启动浏览器进行测试</p><p>打开浏览器输入：<a href="http://192.168.206.128/www/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/www/a.html</a></p><p><img src="/mynote/assets/640-1685433394197-14.151a4391.png" alt="图片"></p><h3 id="_5-5、关闭服务" tabindex="-1">5.5、关闭服务 <a class="header-anchor" href="#_5-5、关闭服务" aria-label="Permalink to &quot;5.5、关闭服务&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat/bin/shutdown.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="第六章-nginx高可用集群" tabindex="-1">第六章：Nginx高可用集群 <a class="header-anchor" href="#第六章-nginx高可用集群" aria-label="Permalink to &quot;第六章：Nginx高可用集群&quot;">​</a></h2><h3 id="_6-1、概述" tabindex="-1">6.1、概述 <a class="header-anchor" href="#_6-1、概述" aria-label="Permalink to &quot;6.1、概述&quot;">​</a></h3><p>前边我们学习了反向代理、负载均衡、动静分离，但试想一下，如果Nginx挂掉了，那么服务肯定就没有了，有没有一种解决方案，可以保证Nginx挂掉了，服务也可以照常使用，答案肯定是有的，这就是我们接下来要学习的高可用集群，采用的是一主一备的模式，当主节点Nginx挂掉，备份服务器Nginx立刻跟上，这样就保证了服务的高可用性。</p><h3 id="_6-2、实现效果" tabindex="-1">6.2、实现效果 <a class="header-anchor" href="#_6-2、实现效果" aria-label="Permalink to &quot;6.2、实现效果&quot;">​</a></h3><p>当主节点Nginx挂掉以后，服务依然可以正常使用。</p><h3 id="_6-3、实现思路" tabindex="-1">6.3、实现思路 <a class="header-anchor" href="#_6-3、实现思路" aria-label="Permalink to &quot;6.3、实现思路&quot;">​</a></h3><p><img src="/mynote/assets/640-1685433430346-17.2d75093c.png" alt="图片"></p><h3 id="_6-4、实现步骤" tabindex="-1">6.4、实现步骤 <a class="header-anchor" href="#_6-4、实现步骤" aria-label="Permalink to &quot;6.4、实现步骤&quot;">​</a></h3><p>第一步：修改主</p><p>Kubernetes 是目前唯一被业界广泛认可的 Docker 分布式解决方案。通过Kubernetes，我们可以轻装上阵的开发与管理复杂的业务系统。Kubernetes 已经毫无疑问地成为容器领域当之无愧的事实标准。</p><p>节点上的Nginx的配置文件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">upstream myserver {</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8081;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://myserver;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第二步：启动主节点上的两台Tomcat</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/startup.sh</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/startup.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第三步：安装主节点上的keepalived</p><p>安装keepalived：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># yum install -y keepalived</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>删除keepalived的配置文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># rm -f /etc/keepalived/keepalived.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>新增keepalived的配置文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /etc/keepalived/keepalived.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意：一定要注意router_id、state、interface的值，我就在这里踩坑了。</p><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">! Configuration File for keepalived</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">global_defs {</span></span>
<span class="line"><span style="color:#A6ACCD;">   notification_email {</span></span>
<span class="line"><span style="color:#A6ACCD;">     acassen@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">     failover@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">     sysadmin@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   notification_email_from Alexandre.Cassen@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">   #邮件服务器通知地址（暂不配置，默认即可）</span></span>
<span class="line"><span style="color:#A6ACCD;">   smtp_server 192.168.200.1</span></span>
<span class="line"><span style="color:#A6ACCD;">   #邮件服务器超时时间（暂不配置，默认即可）</span></span>
<span class="line"><span style="color:#A6ACCD;">   smtp_connect_timeout 30</span></span>
<span class="line"><span style="color:#A6ACCD;">   #当前虚拟机的IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;">   router_id 192.168.206.128</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">vrrp_script Monitor_Nginx {</span></span>
<span class="line"><span style="color:#A6ACCD;"> script &quot;/etc/keepalived/nginx_check.sh&quot;    #检测脚本执行的路径</span></span>
<span class="line"><span style="color:#A6ACCD;"> interval 2                                 #检测脚本执行的间隔</span></span>
<span class="line"><span style="color:#A6ACCD;"> weight 2                                   #检测脚本执行的权重</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#A6ACCD;">    state MASTER         #标识这个机器是MASTER还是BACKUP</span></span>
<span class="line"><span style="color:#A6ACCD;">    interface eth0       #当前机器的网卡名称  </span></span>
<span class="line"><span style="color:#A6ACCD;">    virtual_router_id 51 #虚拟路由的编号，主备必须一致</span></span>
<span class="line"><span style="color:#A6ACCD;">    priority 100         #主、备机取不同的优先级，主机值较大，备份机值较小</span></span>
<span class="line"><span style="color:#A6ACCD;">    advert_int 1         #（VRRP Multicast广播周期秒数）</span></span>
<span class="line"><span style="color:#A6ACCD;">    authentication {</span></span>
<span class="line"><span style="color:#A6ACCD;">        auth_type PASS   #（VRRP认证方式）</span></span>
<span class="line"><span style="color:#A6ACCD;">        auth_pass 1111   #（密码）</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    track_script {</span></span>
<span class="line"><span style="color:#A6ACCD;">  Monitor_Nginx #（调用Nginx进程检测脚本）</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;">    virtual_ipaddress {</span></span>
<span class="line"><span style="color:#A6ACCD;">        192.168.206.50  #虚拟IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>新增keepalived的检测脚本：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /etc/keepalived/nginx_check.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#!/bin/bash</span></span>
<span class="line"><span style="color:#A6ACCD;">if [ &quot;$(ps -ef | grep &quot;nginx: master process&quot; | grep -v grep )&quot; == &quot;&quot; ]</span></span>
<span class="line"><span style="color:#A6ACCD;"> then</span></span>
<span class="line"><span style="color:#A6ACCD;"> killall keepalived</span></span>
<span class="line"><span style="color:#A6ACCD;">fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>启动keepalived服务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[root@caochenlei ~]# service keepalived start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第四步：准备一台全新的虚拟机，安装Nginx和keepalived</p><p>启动虚拟机：</p><p><img src="/mynote/assets/640-1685433576998-24.9ade4390.png" alt="图片"></p><p>安装Nginx依赖：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]*</span><span style="color:#A6ACCD;"># yum install -y gcc gcc-c++ make libtool wget pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><span style="color:#89DDFF;">*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>下载Nginx文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># wget http://nginx.org/download/nginx-1.18.0.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装Nginx程序：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># tar -zxvf nginx-1.18.0.tar.gz</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># cd nginx-1.18.0</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei nginx-1.18.0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># ./configure</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei nginx-1.18.0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># make </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei nginx-1.18.0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># cd </span><span style="color:#89DDFF;">~</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>开放Nginx防火墙：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /etc/rc.d/init.d/iptables save</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables：将防火墙规则保存到</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/iptables：</span><span style="color:#A6ACCD;">     [确定]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改Nginx的配置：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-config line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">upstream myserver {</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.206.128:8081;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    server {</span></span>
<span class="line"><span style="color:#A6ACCD;">        listen       80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name  192.168.206.128;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #charset koi8-r;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://myserver;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>启动Nginx的服务：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装keepalived：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># yum install -y keepalived</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>删除keepalived的配置文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># rm -f /etc/keepalived/keepalived.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>新增keepalived的配置文件：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /etc/keepalived/keepalived.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意：一定要注意router_id、state、interface的值，我就在这里踩坑了。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Configuration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">File</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">keepalived</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">global_defs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">notification_email</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">acassen@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">failover@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">sysadmin@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">notification_email_from</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Alexandre.Cassen@firewall.loc</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#邮件服务器通知地址（暂不配置，默认即可）</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">smtp_server</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.200.1</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#邮件服务器超时时间（暂不配置，默认即可）</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">smtp_connect_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#当前虚拟机的IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">router_id</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.206.129</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_script</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Monitor_Nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">script</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/etc/keepalived/nginx_check.sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#检测脚本执行的路径</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">interval</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">                                 </span><span style="color:#676E95;font-style:italic;">#检测脚本执行的间隔</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">weight</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">                                   </span><span style="color:#676E95;font-style:italic;">#检测脚本执行的权重</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_instance</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VI_1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">BACKUP</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">#标识这个机器是MASTER还是BACKUP</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">eth1</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">#当前机器的网卡名称  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">virtual_router_id</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">51</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#虚拟路由的编号，主备必须一致</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">priority</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;">#主、备机取不同的优先级，主机值较大，备份机值较小</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">advert_int</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">#（VRRP Multicast广播周期秒数）</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">authentication</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">auth_type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PASS</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#（VRRP认证方式）</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">auth_pass</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1111</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#（密码）</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">track_script</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">Monitor_Nginx</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#（调用Nginx进程检测脚本）</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">virtual_ipaddress</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">192.168.206.50</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#虚拟IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>新增keepalived的检测脚本：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># vi /etc/keepalived/nginx_check.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#!/bin/bash</span></span>
<span class="line"><span style="color:#A6ACCD;">if [ &quot;$(ps -ef | grep &quot;nginx: master process&quot; | grep -v grep )&quot; == &quot;&quot; ]</span></span>
<span class="line"><span style="color:#A6ACCD;"> then</span></span>
<span class="line"><span style="color:#A6ACCD;"> killall keepalived</span></span>
<span class="line"><span style="color:#A6ACCD;">fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>启动keepalived服务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[root@caochenlei ~]# service keepalived start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>第五步：测试两个Nginx是否能正确的将请求分发到不同的Tomcat（负载均衡）</p><p>打开IE浏览器输入：<a href="http://192.168.206.128/edu/a.html" target="_blank" rel="noreferrer">http://192.168.206.128/edu/a.html</a></p><p><img src="/mynote/assets/640-1685433743307-27.75696505.png" alt="图片"></p><p>按住F5多刷新两遍，看看会不会，将请求转发到Tomcat2中去。</p><p><img src="/mynote/assets/640-1685433743307-28.02cfc7bb.png" alt="图片"></p><p>打开IE浏览器输入：<a href="http://192.168.206.129/edu/a.html" target="_blank" rel="noreferrer">http://192.168.206.129/edu/a.html</a></p><p><img src="/mynote/assets/640-1685433743307-29.d8d8f88f.png" alt="图片"></p><p>按住F5多刷新两遍，看看会不会，将请求转发到Tomcat2中去。</p><p><img src="/mynote/assets/640-1685433743307-30.ce496d6e.png" alt="图片"></p><p>打开IE浏览器输入：<a href="http://192.168.206.50/edu/a.html%EF%BC%8C%E6%B5%8B%E8%AF%95%E8%99%9A%E6%8B%9FIP%E8%83%BD%E4%B8%8D%E8%83%BD%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E3%80%82" target="_blank" rel="noreferrer">http://192.168.206.50/edu/a.html，测试虚拟IP能不能实现负载均衡。</a></p><p><img src="/mynote/assets/640-1685433743307-31.f71a3541.png" alt="图片"></p><p>按住F5多刷新两遍，看看会不会，将请求转发到Tomcat2中去。</p><p><img src="/mynote/assets/640-1685433743307-32.b3874e7f.png" alt="图片"></p><p>经过测试，我们发现一主一从、虚拟IP都能正常的进行负载均衡，接下来我们测试主节点挂掉，从节点会不会自动顶上，打开主节点机器，查看相关进程，杀死Nginx，然后打开浏览器，输入配置的虚拟IP地址：<a href="http://192.168.206.50/edu/a.html%EF%BC%8C%E5%8F%91%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%95%88%E6%9E%9C%E8%BF%98%E5%9C%A8%EF%BC%8C%E8%AF%B4%E6%98%8E%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F%E4%BA%86%E3%80%82" target="_blank" rel="noreferrer">http://192.168.206.50/edu/a.html，发现负载均衡的效果还在，说明配置成功了。</a></p><p><img src="/mynote/assets/640-1685433743307-31.f71a3541.png" alt="图片"></p><p><img src="/mynote/assets/640-1685433743307-32.b3874e7f.png" alt="图片"></p><h3 id="_6-5、关闭服务" tabindex="-1">6.5、关闭服务 <a class="header-anchor" href="#_6-5、关闭服务" aria-label="Permalink to &quot;6.5、关闭服务&quot;">​</a></h3><p>主机节点：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># service keepalived stop</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat1/bin/shutdown.sh</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/tomcat2/bin/shutdown.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>备份节点：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># service keepalived stop</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@caochenlei </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># /usr/local/nginx/sbin/nginx -s quit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="第七章-nginx配置详解" tabindex="-1">第七章：Nginx配置详解 <a class="header-anchor" href="#第七章-nginx配置详解" aria-label="Permalink to &quot;第七章：Nginx配置详解&quot;">​</a></h2><p>Nginx是通过配置文件来做到各个功能的实现的。Nginx的配置文件的格式非常合乎逻辑，学习这种格式以及如何使用这种每个部分是基础，这将帮助我们有可能手工创建一个配置文件。</p><h3 id="_7-1、整体结构图" tabindex="-1">7.1、整体结构图 <a class="header-anchor" href="#_7-1、整体结构图" aria-label="Permalink to &quot;7.1、整体结构图&quot;">​</a></h3><p><img src="/mynote/assets/640-1685433790720-45.e18d6c15.png" alt="图片"></p><h3 id="_7-2、配置演示图" tabindex="-1">7.2、配置演示图 <a class="header-anchor" href="#_7-2、配置演示图" aria-label="Permalink to &quot;7.2、配置演示图&quot;">​</a></h3><p><img src="/mynote/assets/640-1685433808885-48.8abfbf40.png" alt="图片"></p><h3 id="_7-3、全局块" tabindex="-1">7.3、全局块 <a class="header-anchor" href="#_7-3、全局块" aria-label="Permalink to &quot;7.3、全局块&quot;">​</a></h3><p>配置影响Nginx全局的指令。主要包括：</p><ul><li>配置运行Nginx服务器用户（组）</li><li>worker process数</li><li>Nginx进程</li><li>PID存放路径错误日志的存放路径</li><li>一个Nginx进程打开的最多文件描述符数目</li></ul><p>例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#配置worker进程运行用户（和用户组），nobody也是一个Linux用户，一般用于启动程序，没有密码</span></span>
<span class="line"><span style="color:#A6ACCD;">user nobody;</span></span>
<span class="line"><span style="color:#A6ACCD;">#user www www;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#配置工作进程数目，根据硬件调整，通常等于CPU数量或者2倍于CPU数量</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_processes 1;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#配置全局错误日志及类型，[debug | info | notice | warn | error | crit]，默认是error</span></span>
<span class="line"><span style="color:#A6ACCD;">error_log logs/error.log;</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log logs/error.log notice;</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log logs/error.log info;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#配置进程pid文件</span></span>
<span class="line"><span style="color:#A6ACCD;">pid logs/nginx.pid;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与Nginx进程数相除，但是Nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_rlimit_nofile 65535;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_7-4、events块" tabindex="-1">7.4、events块 <a class="header-anchor" href="#_7-4、events块" aria-label="Permalink to &quot;7.4、events块&quot;">​</a></h3><p>配置影响Nginx服务器或与用户的网络连接。主要包括：</p><ul><li>事件驱动模型的选择</li><li>最大连接数的配置</li></ul><p>例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; </span></span>
<span class="line"><span style="color:#A6ACCD;">#epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span></span>
<span class="line"><span style="color:#A6ACCD;">use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#单个进程最大连接数（最大连接数=连接数*进程数）</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_connections 65535;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_7-5、http块" tabindex="-1">7.5、http块 <a class="header-anchor" href="#_7-5、http块" aria-label="Permalink to &quot;7.5、http块&quot;">​</a></h3><p>可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。主要包括：</p><ul><li>定义MIMI-Type</li><li>自定义服务日志</li><li>允许sendfile方式传输文件</li><li>连接超时时间</li><li>单连接请求数上限</li></ul><p>例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#常见的一些基础配置</span></span>
<span class="line"><span style="color:#A6ACCD;">include mime.types; #文件扩展名与文件类型映射表</span></span>
<span class="line"><span style="color:#A6ACCD;">default_type application/octet-stream; #默认文件类型</span></span>
<span class="line"><span style="color:#A6ACCD;">charset utf-8; #默认编码</span></span>
<span class="line"><span style="color:#A6ACCD;">server_names_hash_bucket_size 128; #服务器名字的hash表大小</span></span>
<span class="line"><span style="color:#A6ACCD;">client_header_buffer_size 32k; #上传文件大小限制</span></span>
<span class="line"><span style="color:#A6ACCD;">large_client_header_buffers 4 64k; #设定请求缓冲</span></span>
<span class="line"><span style="color:#A6ACCD;">client_max_body_size 8m; #设定请求缓冲</span></span>
<span class="line"><span style="color:#A6ACCD;">sendfile on; #开启高效文件传输模式，对于普通应用设为on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span></span>
<span class="line"><span style="color:#A6ACCD;">autoindex on; #开启目录列表访问，合适下载服务器，默认关闭。</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp_nopush on; #防止网络阻塞</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp_nodelay on; #防止网络阻塞</span></span>
<span class="line"><span style="color:#A6ACCD;">keepalive_timeout 120; #长连接超时时间，单位是秒</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_connect_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_send_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_read_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_buffer_size 64k;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_buffers 4 64k;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_busy_buffers_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;">fastcgi_temp_file_write_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#gzip模块设置</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip on; #开启gzip压缩输出</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_min_length 1k; #最小压缩文件大小</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_buffers 4 16k; #压缩缓冲区</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_comp_level 2; #压缩等级</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_types text/plain application/x-javascript text/css application/xml; #压缩类型</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_vary on; #增加响应头&#39;Vary: Accept-Encoding&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_7-6、server块" tabindex="-1">7.6、server块 <a class="header-anchor" href="#_7-6、server块" aria-label="Permalink to &quot;7.6、server块&quot;">​</a></h3><p>配置虚拟主机的相关参数，一个http中可以有多个server。主要包括：</p><ul><li>配置网络监听</li><li>配置https服务</li><li>基于名称的虚拟主机配置</li><li>基于IP的虚拟主机配置</li></ul><p>例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#虚拟主机的常见配置</span></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    listen       80; #配置监听端口</span></span>
<span class="line"><span style="color:#A6ACCD;">    server_name  localhost; #配置服务名</span></span>
<span class="line"><span style="color:#A6ACCD;">    charset utf-8; #配置字符集</span></span>
<span class="line"><span style="color:#A6ACCD;">    access_log  logs/host.access.log  main; #配置本虚拟主机的访问日志</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">        root html; #root是配置服务器的默认网站根目录位置，默认为Nginx安装主目录下的html目录</span></span>
<span class="line"><span style="color:#A6ACCD;">        index index.html index.htm; #配置首页文件的名称</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    error_page 404             /404.html; #配置404错误页面</span></span>
<span class="line"><span style="color:#A6ACCD;">    error_page 500 502 503 504 /50x.html; #配置50x错误页面</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#配置https服务，安全的网络传输协议，加密传输，端口443</span></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    listen       443 ssl;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server_name  localhost;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_certificate      cert.pem;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_certificate_key  cert.key;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_session_cache    shared:SSL:1m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_session_timeout  5m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ssl_prefer_server_ciphers  on;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">        root   html;</span></span>
<span class="line"><span style="color:#A6ACCD;">        index  index.html index.htm;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_7-7、location块" tabindex="-1">7.7、location块 <a class="header-anchor" href="#_7-7、location块" aria-label="Permalink to &quot;7.7、location块&quot;">​</a></h3><p>配置请求的路由，以及各种页面的处理情况。主要包括：</p><ul><li>请求根目录配置更改</li><li>网站默认首页配置</li><li>location的URI</li></ul><p>例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">root html; #root是配置服务器的默认网站根目录位置，默认为Nginx安装主目录下的html目录</span></span>
<span class="line"><span style="color:#A6ACCD;">index index.html index.htm; #配置首页文件的名称</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_pass http://127.0.0.1:88; #反向代理的地址</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_redirect off; #是否开启重定向</span></span>
<span class="line"><span style="color:#A6ACCD;">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_set_header Host $host;</span></span>
<span class="line"><span style="color:#A6ACCD;">#以下是一些反向代理的配置，可选。</span></span>
<span class="line"><span style="color:#A6ACCD;">client_max_body_size 10m; #允许客户端请求的最大单文件字节数</span></span>
<span class="line"><span style="color:#A6ACCD;">client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间（代理连接超时）</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_send_timeout 90; #后端服务器数据回传时间（代理发送超时）</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_read_timeout 90; #连接成功后，后端服务器响应时间（代理接收超时）</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_buffer_size 4k; #设置代理服务器（Nginx）保存用户头信息的缓冲区大小</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）</span></span>
<span class="line"><span style="color:#A6ACCD;">proxy_temp_file_write_size 64k;  #设定缓存文件夹大小</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>location的URI：</p><p>描述：该指令用于匹配URL</p><p>语法：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaAAAABTCAYAAADZR9NaAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAPUklEQVR42u3deXRUVYLH8W8tqUotWSpLJaEC2VcIJGyyyyZgIy6oqLigLYzaPWq37Ti2czzT7RlHW2e0dTi2047LSGMriEvboCLaigQBG0GQRUJMSCRs2fe1av5IWrBthwqQetr8Pn9Vnar37n2vqt7v3ftuvWsKBAIBREREQsxsdAVEROTsZP3Lg507dxpdFxEROUsUFBQcD6DOzk7S09MxmUxG10tERM4C1hOf2Gw2BZCIiISErgGJiIghFEAiImIIBZCIiBhCASQiIoZQAImIiCEUQCIiYggFkIiIGEIBJCIihlAAiYiIIYIMoDo++OMK5r74B96p7qEn6Ptn17HhV/O5eO4c7n2rkrYuv9Hb26t0DUs/rORYS0/oyixbx09vvpY5dy5nU0UDXSEosmL9evZUVdEcso1sZvem7ZSWH6bjTK625XO27ixh/8H2fi7Yyv7tn/H55xW0hWDrj+16gcfvmcON9z3Je1+EosQ+tfvZsnUjq/e19HvRjkPbePXFJ/n31/aE8Hsi0ssazJvqtr7Prugx/LBjI3Vd/Zm9wUX2vJ9wR8563m/yE6qJHxo2r2F3yhQK4904LH/jDd5CZkVEEWEP4W2HWo8yaMICJmYUkBnrwHIGVnkybdXVNCUn0x2yjeyhqbaB7kgPZ+ZU4xCHD4dj72imrsGMxVHF4cMe7HYPHk9w9Wmub6SnO6yf9Wnliz8t44UNtfimLuTKySk4glgqwjeB2Rd2ElEZiz+UJzeuBDLSovBZ7f1csIPq8mb8xyIZe8kgwkNXYxEINoCcqWOYa/Nh3/Qxxf26V5wNb/4UvHG17Ci2fKO5Vb/xEX706w00t3fDyB/x+D9NZ7DL1ndw3s8fr/tXnq9vop0ibropj47UC5mT7cRZsZobfrGMmoZWYD4//5/LGeV1YaOezUvv4JGXt1MRloAnPAyraQQ3PvRTzsuKwWkp5a2b72dZVTVpP3yQn5yXQ/gJe6Dh4ye5+4n3OFjTDgWLuP/2OeR5XbRufYqfP+GkcNzbbNhQT13dMK697zbmDEskIqg92MuXO4oJeYOIcxn7oX9/hHG0+LcsX/UmGyrBZk9n9qLFXHHRBILKn1PUWlZMRWsYWTmpNDVVsPmAl6kpJ4+g8OhUcoaNpc7cFHTot1d+xKoV71HqOIerry+iZ+0qXnymFMeFC7lu8QiivtzMayuX8W5DDvOmD6ftk5dZV5fFpdfeyJzMTvavfpUX//s1ygunc+m1S/BF9uMLiZ9OuxOPL4WC5KjgDgYiZ1BQ3zl7bDIpwJEz2WDY/wY3f+bjyuv/AafVDPWl/OytvTw1N5+Y8GY2Pf4CDbOv5IZYOxZzPWUPP0bznVPpyXKCzcWU+TfgdZgIazrGWx+WkjMnlxiXk7Rp17Ow6TV2JE9ieJwbhyWGnEQXNhNAPMOuuZ7Fhz7ko04zgRP7EsvWctcuD1PnX0+s3QoNB3ho/V7umzkUX8pkJvjuZHP3LOYuyCS67UvW76lk3JBoImIG4ryxiR3L7+ept/dS2fj1V2Yu/iWXTxtBwlkRYtGkjP0Bcxug5Z1NtGcVMXJ0Ft6B3PbWMjaWd9ISNY7ZExOp+HQZe3dXsse1kLy4M1+c1ZPOiPwKrK3dNPe4SC0cS9EYE8c66mgHYj1pjJk0hapV63j2mTJyZ85gXpKJsKo9HMkswFswkblLzHza6qCr6RRaXTYrVqcN2wDuUpFvY9hJz/7NFZw75VJmZXlxWszQUE757zZwsCeTyIYd7AmfyLnnTyTFE47F1MABayzdQ6NxWIHwbo68upy3mlvo7jrKZ+fcw+KZOcRgxzt0ChMP7MOcP51pydG4v7aFkSRPmkJydQtlm+xf6wYr23aQsaOmcl7OEOJsFmis5OjLG6npSiMpPpfhGWNwjJ7L1Ow0YgKfUPLgEVontNMdEz4AO9GOb8xFLEg8l+bOr7+SnOcjYsCOFs3sefUxnlvtYuyNlzOroJF1a2oYUpBDQV78AB2kDrP1iWdZURrNhGsvYXZiFc/t6SQ9JZdZ6dFE2brZGZvP0MsSCVgG4bBacQ1k/6UtlryhYzGHRRAdHY694HziOsw43ABtHPjwJVasOIBr0gIWXOhkb3ElbfbBTAqym+6vWd0JpKWn017bCoQTlZpFTlEdYTV9r7u8ZOQXMq7Wj716MNNmF5Ee1kV7Vxc27DiH5FAUZ8H0+WGqNbexfM8YFkCN9TAqJYowS1/HXFQqo81v0kaAQGc97d4ivI4wLCaAKFKmz+hbsoGPl1eSdvF88m1WzJSxttR1Sj/+EzU1QMGgSJy2vqNb5GBGWNppo6fv+kEqyfER2MPMQDgRLV34/QEG5jffQdXW1byybh8Hm77+yrQbfCTEx+EMG4Biq7bzUUcqOeN7KH/xV9z2UAfJs64k2+MesGtWLSXFHIzwUpAfRvHyB3h+t52syy5hwsi+TzTCx5RRiUQ4zJi6zDgcp/tJn4Q1Ep/3+FNHTPbx71b1fnY12rAXpGHa+Tv+5aVDuEfO4eKrhjMQH8eJwuMHk+ctID/O2fv8tNfYwZEda9m5eQ+Oc27COcD1F/lbDAug9GxYfQAKMiHMClDKPtI5FyuWyGxiP9lC+bTzyXE4CQO+ePsW1jjvYtHYNnZ/bmfMNTPJinPT+ueHeaLMT+e3FVT2DrfvSeLuKdkkub/9HD4lHd45DFlucNoBDlCKj0LsBnRP2EksnM08z9hvtICG5CThHqgKRaYz+dyhxLq6qRmWyrAj4BsxjLT4gRs0YYsbyejZLlzWAMP2p1Jx2EHm8GwyovouqDu9FHxXjo6uQQwfncCI8VY4lEdOaRMRGdnkpESe5g+pjrbWRjqaob1xJxs3baYkfBx5A7oxVtxJ2SQO8dPcWE0nngEPUZG/FtTvpv7Tddx+oIXmI8eoqXmDVeFObp48g4keS18L5VuUrmHJ/StobTzA/moPG1aEYylazEO3TiZp9HjMT/wjt+xtp3d09hDOXfJjosPCMNvSmDTtU56748fsbe+kBxg8ZTKzZ0Rhs0QzYuRLPHznLXR0+ekcnYz39Ud5Ps3HLTPTiQq3EJHpYfu/3cnK1jZ6Bk9kwuW5vS2b8nf52SMrOVxVQnltBG8+78RWeDX33jSNrBGjsDzzC/754VpaugB8jL9mMVOcTtq2P8/SV5ZRsd/JA7dOxv/2Ul55/3NWpkTw2MKJpEef6etANuLzJjN9YI9A3+QeRJa792HMOfFkhaDIME8ag/oeF45NoDDEm9wvjliS/9IcionBN/TMrNYeE0PTundZufRVHs9MwN3RTOBgDa+/n8Llg/eybuVv+P36TrpMkTwdnc/YWZdy1aICvPVlrF39Cv/7xnrqm9rpDETxbHYRky5YwKKZGSdp1VhwxacS7+uk/cv6EI6UFDkuqAAKT0jjYnsX/uycrxZLcZg46ZgETxbzLryIrp4TBsEmpBFhNWPy5DNl1kU487vo9gMkUFTkxWY1A3YGjZ/ErBYHeR1d+IGEwhmMSYnEbjWTO3celyVW0t7ph+xssjPKaMmNxW7trZE9ZTxz59upaOugxzucqUMTibBZIDqNWXPm0tx2QrMiPos4RxgmZw7jpl2ALaOZ9m56ByyM8uF2WAkkDufSm26lyZ1LkstNz/D53HRPE60pmXjCNXZITo/Vk82IqZdiTaykKTaRxOgwbK2dmJOicUdlMnzyIpxfnQ3E4Mvw4gIIjyajYDzzw1OPr8zpZUiaWjPy/WAKBHr/nbN161Zyc3M1JfdA2fUCi5d+SFPiHO5eMo2CQafbbXNyjZWVdHk8RLjdIepG7KS6qg6Ly01ElOs7MKy3i7oj9QSsdiJjB35/1+57nT+seo4N7dOZd9kNXFTgNnoHnEQ3tSWbWfOnT6hJO58l52XqWpCEjNPp/A4cI84WvvFcMc9FtS0Dr8t28tbjGRA5eHCIN9JG3KCEEJf5/wnDkxAfstLCPRkMHbeAOGsOw5L7+6dQI1iJTMpgzEQH1dZoHQwk5NQCEhGRkHM6nboZqYiIGEMBJCIihlAAiYiIIRRAIiJiCAWQiIgYQgEkIiKGUACJiIghFEAiImIIBZCIiBhCASQiIoYI8vZPR9lYXMJ7gQB+Irlu/FCGWCxKLxEROWVBZcjBXZ+wpxVMJhOW6t08/Ekp9X7/AM0GKiIiZ4OgWkCBQBznjBtJvtuM+dhmrvugmkBRhjrwRETklAUVQMnDRpPc97i5pYtpyRlEmoKYkE5ERORb9KsN01L+Kb/e2UBaSjxmk5o/IiJy6oJOkZbyT3lsRyVtyUVMTDBjUf6IiMhpCCpGWg7s4L92VNDoK+IXhVGU7S7hkN+P3+jai4jI91YQAVTDn4vX88ARSPRX8dttH/MfH2zjix6NghMRkVMXxCCETnoS8lgSCFDZ0ABARG4mCWYNQhARkVMXRAAlMX1GEtONrqmIiPxd0VACERExhAJIREQMoQASERFDKIBERMQQCiARETGEAkhERAyhABIREUMogERExBAKIBERMYQCSEREDKEAEhERQyiARETEEEFNyQ3QUfMlxU1d+ANWhib5SLCbMQdzO+yOo3z20RFix+SR4LQGt4yIiPzdC6oF1FFzkDc3FfPo5i08uqWYt/ZV0xYIBDcfUGsJax78DW+Xd9ClGexERKRPcDOilm3jacdoVl12OauvKKBxy3bq/UGmiWcid92fz6GaHnr8msJORER6BdUFFzP6At6ghS+/rOJAoAGrJ4qwfhZUcqwef8ANmsZORET6cw0IjlC8YTNP+wMsHD4Lt7kf4xdsNlxGb6mIiHyn9CNF0rniyqtYu3Ac1m1bqOjoIRBsj5ovh1Hdu6ioaVM3nIiIQHAB1EXt0aPUdgb6AieRkVHN7GuGoMcU2HPx1v8nv99xjI5uBZCIiATVBdfEtuJ1HM6eSm6MGbOpnOLaKCZHgynYyzl7V/Jy3DM8Pi0Zp01/PRIRkaACKIYZl5zD8mXruM0fwI+Te39wCUOtVixG115ERL63ghyEkMHV12Zw9amU0FrNnrIWnOEWjX8TEZGvDHx/WNlabnmsmpnDPNis6n4TEZFepkCgd2jB1q1byc3NxRT0hR0REZFT43Q6dTNSERExhgJIREQMoQASERFDKIBERMQQCiARETGEAkhERAyhABIREUMogERExBAKIBERMcTX7gXn9/t1JwQREQmJrwLIZDJRUlJidH1EROQsMHLkyOP3ghMREQklXQMSERFD/B8/XnPx7IeS6QAAAABJRU5ErkJggg==" alt="图片"></p><p>通配符：</p><ul><li>=：用于不含正则表达式的uri前，要求请求字符串与uri严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。</li><li>~：用于表示uri包含正则表达式，并且区分大小写。</li><li>~*：用于表示uri包含正则表达式，并且不区分大小写。</li><li>^~：用于不含正则表达式的uri前，要求Nginx服务器找到标识uri和请求字符串匹配度最高的location后，立即使用此location处理请求，而不再使用location块中的正则uri和请求字符串做匹配。</li></ul><p>注意：如果uri包含正则表达式，则必须要有~或者~*标识。</p><h2 id="第八章-nginx原理分析" tabindex="-1">第八章：Nginx原理分析 <a class="header-anchor" href="#第八章-nginx原理分析" aria-label="Permalink to &quot;第八章：Nginx原理分析&quot;">​</a></h2><h3 id="_8-1、nginx的线程模型" tabindex="-1">8.1、Nginx的线程模型？ <a class="header-anchor" href="#_8-1、nginx的线程模型" aria-label="Permalink to &quot;8.1、Nginx的线程模型？&quot;">​</a></h3><p>Nginx默认采用多进程工作方式，Nginx启动后，会运行一个master进程和多个worker进程。其中master充当整个进程组与用户的交互接口，同时对进程进行监护，管理worker进程来实现重启服务、平滑升级、更换日志文件、配置文件实时生效等功能。worker用来处理基本的网络事件，worker之间是平等的，他们共同竞争来处理来自客户端的请求。</p><p>Nginx的进程模型如图所示：</p><p><img src="/mynote/assets/640-1685433885314-54.9af0aecc.png" alt="图片"></p><h3 id="_8-2、worker的工作模式" tabindex="-1">8.2、worker的工作模式？ <a class="header-anchor" href="#_8-2、worker的工作模式" aria-label="Permalink to &quot;8.2、worker的工作模式？&quot;">​</a></h3><p>worker对于连接是采用争抢的模式，谁先抢到就先交给谁处理，如果想要重新更新配置，由于已经抢到任务的worker不会参与争抢，那些空闲的worker就会去争抢连接，拿到连接后会自动更新配置信息，当那些有任务的worker完成任务后，会自动更新配置，这样就实现了无缝热部署。由于每个worker是独立的进程，如果有其中的一个worker出现问题，并不会影响其它worker继续进行争抢，在实现请求的过程，不会造成服务中断，建议worker数和服务器的CPU数相等是最为适宜的。</p><p><img src="/mynote/assets/640-1685433899574-57.4e4127c4.png" alt="图片"></p><h3 id="_8-3、如何计算worker连接数" tabindex="-1">8.3、如何计算worker连接数？ <a class="header-anchor" href="#_8-3、如何计算worker连接数" aria-label="Permalink to &quot;8.3、如何计算worker连接数？&quot;">​</a></h3><p>如果只访问Nginx的静态资源，一个发送请求会占用了woker的2个连接数</p><p>而如果是作为反向代理服务器，一个发送请求会占用了woker的4个连接数</p><h3 id="_8-4、如何计算最大的并发数" tabindex="-1">8.4、如何计算最大的并发数？ <a class="header-anchor" href="#_8-4、如何计算最大的并发数" aria-label="Permalink to &quot;8.4、如何计算最大的并发数？&quot;">​</a></h3><p>如果只访问nginx的静态资源，最大并发数量应该是：worker_connections * worker_processes / 2</p><p>而如果是作为反向代理服务器，最大并发数量应该是：worker_connections * worker_processes / 4</p><p>原文链接：<a href="https://blog.csdn.net/qq_38490457/article/details/108300342" target="_blank" rel="noreferrer">https://blog.csdn.net/qq_38490457/article/details/108300342</a></p></div></div></main><footer class="VPDocFooter" data-v-c4b0d3cf data-v-face870a><!--[--><!--]--><div class="edit-info" data-v-face870a><!----><div class="last-updated" data-v-face870a><p class="VPLastUpdated" data-v-face870a data-v-7b3ebfe1>Last updated: <time datetime="2023-05-30T08:15:37.000Z" data-v-7b3ebfe1></time></p></div></div><div class="prev-next" data-v-face870a><div class="pager" data-v-face870a><a class="pager-link prev" href="/mynote/note/后端/Java语言基础/11.Instrument相关介绍/" data-v-face870a><span class="desc" data-v-face870a>Previous page</span><span class="title" data-v-face870a>11.Instrument相关介绍</span></a></div><div class="has-prev pager" data-v-face870a><a class="pager-link next" href="/mynote/note/数学/数理统计/" data-v-face870a><span class="desc" data-v-face870a>Next page</span><span class="title" data-v-face870a>数理统计</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"note_后端_java语言基础_05.各版本特性_index.md\":\"d5355ed1\",\"index.md\":\"341610c5\",\"note_linux_基础知识_index.md\":\"58174d5e\",\"note_linux_容器技术_index.md\":\"958fc829\",\"note_后端_java日志系统_index.md\":\"4eadf527\",\"note_后端_java语言基础_04.常用模块_index.md\":\"367e1c77\",\"note_后端_java语言基础_01.基础语法_index.md\":\"81a13f49\",\"note_后端_java语言基础_02.面向对象_index.md\":\"ca473671\",\"note_后端_java语言基础_03.高级语法_index.md\":\"8c433cf9\",\"note_后端_java语言基础_06.并发编程及juc_4.原理_index.md\":\"58c1a8b2\",\"note_后端_java语言基础_06.并发编程及juc_3.应用_index.md\":\"d60d63f7\",\"note_后端_java语言基础_06.并发编程及juc_2.模式_index.md\":\"c4ae29b0\",\"note_后端_java语言基础_06.并发编程及juc_5.volatile的性能分析_index.md\":\"9002c978\",\"note_后端_java语言基础_08.字节码动态代码_index.md\":\"7e18614b\",\"note_后端_java语言基础_09.常用监控工具_index.md\":\"fb9600ab\",\"note_后端_java语言基础_07.jvm_index.md\":\"7d6a265f\",\"note_后端_java语言基础_11.instrument相关介绍_index.md\":\"fba69a2e\",\"note_后端_java语言基础_10.代码热更新_index.md\":\"14e25aa0\",\"note_编程基础_数据库原理_index.md\":\"c5ac2865\",\"note_工具_持续集成_jenkins.md\":\"0e247c64\",\"note_编程基础_uml_index.md\":\"c4313863\",\"note_美术_index.md\":\"222f1e75\",\"note_英语_词根-词缀记忆_index.md\":\"76b3c2db\",\"note_数学_数理统计_index.md\":\"7d1c59d3\",\"note_数学_逻辑学_index.md\":\"22ef5f29\",\"note_数学_概率论_index.md\":\"87d6274e\",\"note_数学_高等数学_index.md\":\"e8bb7160\",\"note_数据库_mysql_index.md\":\"e02b39b1\",\"note_编程基础_设计模式_index.md\":\"50e060d6\",\"note_脚本语言_lua_index.md\":\"b4b2ca07\",\"note_杂_index.md\":\"10e8e2ca\",\"note_脚本语言_python_index.md\":\"497f6f4f\",\"note_编程基础_计算机系统结构_index.md\":\"4bd9b0f0\",\"note_编程基础_计算机组成_index.md\":\"7822445f\",\"note_编程基础_计算机网络_index.md\":\"ec627669\",\"note_脚本语言_groovy_index.md\":\"8b798f78\",\"note_编程基础_编译原理_index.md\":\"e82865ee\",\"note_英语_语法_index.md\":\"f15f0653\",\"note_方法论_index.md\":\"e8d2e25a\",\"note_编程基础_数据结构与算法_index.md\":\"6e9632e9\",\"note_数学_离散数学_index.md\":\"308883b7\",\"note_数据库_redis_index.md\":\"824b3fec\",\"note_数据库_mongo_index.md\":\"2d6a5dd0\",\"note_数学_线性代数_index.md\":\"67f9e9ff\",\"note_后端_nginx_index.md\":\"77e6c141\",\"note_后端_java语言基础_06.并发编程及juc_1.线程共享模型_index.md\":\"5acf7467\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"笔记整理\",\"description\":\"来源于网络和自己的笔记，算法，数据结构，Java，JUC，JVM，数学\",\"base\":\"/mynote/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"https://developer.mozilla.org/favicon-48x48.cbbd161b.png\",\"siteTitle\":\"我的笔记整理\",\"nav\":[],\"sidebar\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"linux\",\"collapsed\":true,\"items\":[{\"text\":\"基础知识\",\"link\":\"/note/linux/基础知识/\"},{\"text\":\"容器技术\",\"link\":\"/note/linux/容器技术/\"}]},{\"text\":\"后端\",\"collapsed\":true,\"items\":[{\"text\":\"Java日志系统\",\"link\":\"/note/后端/Java日志系统/\"},{\"text\":\"Java语言基础\",\"collapsed\":true,\"items\":[{\"text\":\"01.基础语法\",\"link\":\"/note/后端/Java语言基础/01.基础语法/\"},{\"text\":\"02.面向对象\",\"link\":\"/note/后端/Java语言基础/02.面向对象/\"},{\"text\":\"03.高级语法\",\"link\":\"/note/后端/Java语言基础/03.高级语法/\"},{\"text\":\"04.常用模块\",\"link\":\"/note/后端/Java语言基础/04.常用模块/\"},{\"text\":\"05.各版本特性\",\"link\":\"/note/后端/Java语言基础/05.各版本特性/\"},{\"text\":\"06.并发编程及JUC\",\"collapsed\":true,\"items\":[{\"text\":\"1.线程共享模型\",\"link\":\"/note/后端/Java语言基础/06.并发编程及JUC/1.线程共享模型/\"},{\"text\":\"2.模式\",\"link\":\"/note/后端/Java语言基础/06.并发编程及JUC/2.模式/\"},{\"text\":\"3.应用\",\"link\":\"/note/后端/Java语言基础/06.并发编程及JUC/3.应用/\"},{\"text\":\"4.原理\",\"link\":\"/note/后端/Java语言基础/06.并发编程及JUC/4.原理/\"},{\"text\":\"5.volatile的性能分析\",\"link\":\"/note/后端/Java语言基础/06.并发编程及JUC/5.volatile的性能分析/\"}]},{\"text\":\"07.jvm\",\"link\":\"/note/后端/Java语言基础/07.jvm/\"},{\"text\":\"08.字节码动态代码\",\"link\":\"/note/后端/Java语言基础/08.字节码动态代码/\"},{\"text\":\"09.常用监控工具\",\"link\":\"/note/后端/Java语言基础/09.常用监控工具/\"},{\"text\":\"10.代码热更新\",\"link\":\"/note/后端/Java语言基础/10.代码热更新/\"},{\"text\":\"11.Instrument相关介绍\",\"link\":\"/note/后端/Java语言基础/11.Instrument相关介绍/\"}]},{\"text\":\"nginx\",\"link\":\"/note/后端/nginx/\"}]},{\"text\":\"数学\",\"collapsed\":true,\"items\":[{\"text\":\"数理统计\",\"link\":\"/note/数学/数理统计/\"},{\"text\":\"概率论\",\"link\":\"/note/数学/概率论/\"},{\"text\":\"离散数学\",\"link\":\"/note/数学/离散数学/\"},{\"text\":\"线性代数\",\"link\":\"/note/数学/线性代数/\"},{\"text\":\"逻辑学\",\"link\":\"/note/数学/逻辑学/\"},{\"text\":\"高等数学\",\"link\":\"/note/数学/高等数学/\"}]},{\"text\":\"数据库\",\"collapsed\":true,\"items\":[{\"text\":\"mongo\",\"link\":\"/note/数据库/mongo/\"},{\"text\":\"mysql\",\"link\":\"/note/数据库/mysql/\"},{\"text\":\"redis\",\"link\":\"/note/数据库/redis/\"}]},{\"text\":\"方法论\",\"link\":\"/note/方法论/\"},{\"text\":\"杂\",\"link\":\"/note/杂/\"},{\"text\":\"编程基础\",\"collapsed\":true,\"items\":[{\"text\":\"UML\",\"link\":\"/note/编程基础/UML/\"},{\"text\":\"数据库原理\",\"link\":\"/note/编程基础/数据库原理/\"},{\"text\":\"数据结构与算法\",\"link\":\"/note/编程基础/数据结构与算法/\"},{\"text\":\"编译原理\",\"link\":\"/note/编程基础/编译原理/\"},{\"text\":\"计算机系统结构\",\"link\":\"/note/编程基础/计算机系统结构/\"},{\"text\":\"计算机组成\",\"link\":\"/note/编程基础/计算机组成/\"},{\"text\":\"计算机网络\",\"link\":\"/note/编程基础/计算机网络/\"},{\"text\":\"设计模式\",\"link\":\"/note/编程基础/设计模式/\"}]},{\"text\":\"美术\",\"link\":\"/note/美术/\"},{\"text\":\"脚本语言\",\"collapsed\":true,\"items\":[{\"text\":\"groovy\",\"link\":\"/note/脚本语言/groovy/\"},{\"text\":\"lua\",\"link\":\"/note/脚本语言/lua/\"},{\"text\":\"python\",\"link\":\"/note/脚本语言/python/\"}]},{\"text\":\"英语\",\"collapsed\":true,\"items\":[{\"text\":\"词根-词缀记忆\",\"link\":\"/note/英语/词根-词缀记忆/\"},{\"text\":\"语法\",\"link\":\"/note/英语/语法/\"}]}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>